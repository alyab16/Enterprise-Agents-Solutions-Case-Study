\documentclass[9pt,a4paper]{article}
\usepackage[margin=0.55in,top=0.5in,bottom=0.5in]{geometry}
\usepackage{titlesec}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{float}
\usepackage{multicol}

% Tight spacing
\setlength{\parskip}{0.2em}
\setlength{\parindent}{0pt}
\titlespacing*{\section}{0pt}{0.5em}{0.2em}
\titlespacing*{\subsection}{0pt}{0.3em}{0.1em}
\setlist[itemize]{noitemsep, topsep=1pt, leftmargin=1.2em, parsep=0pt}

% Colors
\definecolor{primary}{RGB}{44, 82, 130}
\definecolor{secondary}{RGB}{113, 128, 150}

% Header/Footer
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\textcolor{secondary}{\footnotesize Enterprise Onboarding Agent}}
\fancyhead[R]{\textcolor{secondary}{\footnotesize Solution Design Document}}
\fancyfoot[C]{\footnotesize\thepage}
\renewcommand{\headrulewidth}{0.4pt}

% Section formatting
\titleformat{\section}{\normalsize\bfseries\color{primary}}{\thesection.}{0.4em}{}
\titleformat{\subsection}{\small\bfseries\color{primary}}{\thesubsection}{0.4em}{}

\begin{document}

% Title
\begin{center}
{\Large\bfseries\color{primary} Enterprise Customer Onboarding Agent}\\[0.15em]
{\normalsize Solution Design Document | February 2025 | StackAdapt Case Study}
\end{center}

\vspace{0.2em}

%==============================================================================
% SECTION A: ARCHITECTURE
%==============================================================================
\section{Architecture Overview}

The solution implements an \textbf{AI-powered automation agent} using \textbf{LangGraph} for state machine orchestration and \textbf{FastAPI} for REST interface, automating customer onboarding from deal closure through SaaS provisioning.

% IMAGE PLACEHOLDER
\begin{figure}[H]
\centering
%\fbox{\parbox{0.95\textwidth}{\centering\vspace{1.2cm}\textbf{[INSERT: 01\_architecture.mmd]} - Render mermaid diagram as PNG\vspace{1.2cm}}}
\includegraphics[width=0.95\textwidth]{01_architecture.png}
\caption{Architecture: Triggers → LangGraph Agent (Init→Fetch→Validate→Analyze→Decide) → Actions}
\end{figure}

\vspace{-0.5em}
\subsection{System Integrations \& Field Selection}

\begin{table}[H]
\footnotesize
\begin{tabularx}{\textwidth}{@{}lXl@{}}
\toprule
\textbf{System} & \textbf{Objects \& Key Fields} & \textbf{Reference} \\
\midrule
\textbf{Salesforce} & \texttt{Account} (IsDeleted, Status), \texttt{Opportunity} (StageName, Amount), \texttt{User} (IsActive) & \href{https://developer.salesforce.com/docs/atlas.en-us.object_reference.meta/object_reference/sforce_api_objects_list.htm}{SF Objects} \\
\textbf{NetSuite} & \texttt{Invoice} (status, dueDate, amountRemaining, paymentStatus) & \href{https://system.netsuite.com/help/helpcenter/en_US/APIs/REST_API_Browser/record/v1/2023.1/index.html}{NS REST API} \\
\textbf{CLM} & Contract status, signatories, effective dates (Mock API) & Custom \\
\textbf{Provisioning} & Tenant creation + 14-task onboarding checklist with dependencies & Internal \\
\bottomrule
\end{tabularx}
\end{table}

\vspace{-0.5em}
\textbf{Why these fields?} Only business-critical fields selected: \texttt{Account.IsDeleted} for validity, \texttt{Opportunity.StageName="Closed Won"} for deal verification, \texttt{Invoice.status} for payment issues. Minimizes API payload and focuses on decision-relevant data.

%==============================================================================
% SECTION B: AI AGENT APPLICATION
%==============================================================================
\section{AI Agent Application}

The agent uses \textbf{OpenAI GPT-4} with a deterministic rule-based fallback ensuring availability without LLM connectivity.

\begin{minipage}[t]{0.52\textwidth}
\vspace{0pt}
\subsection{LLM-Powered Intelligence}
\begin{itemize}
\item \textbf{Risk Analysis}: Evaluates API errors, violations, warnings → generates risk level (low/medium/high/critical) with business impact
\item \textbf{Summary Generation}: Human-readable reports for CS teams
\item \textbf{Action Recommendations}: Prioritized steps with owner assignment (CS, Finance, IT) and resolution timelines
\item \textbf{Error Interpretation}: Translates \texttt{INVALID\_SESSION\_ID} → plain English fix instructions
\end{itemize}

\subsection{Autonomous Actions}
Auto-provisions tenant (tier-appropriate config) • Creates 14-task onboarding checklist • Sends Slack alerts + welcome emails • Records API failures → influences BLOCK decisions
\end{minipage}
\hfill
\begin{minipage}[t]{0.45\textwidth}
\vspace{0pt}
\begin{figure}[H]
\centering
%\fbox{\parbox{0.95\textwidth}{\centering\vspace{1cm}\textbf{[INSERT: 02\_decision\_flow.mmd]}\vspace{1cm}}}
\includegraphics[width=0.95\textwidth]{02_decision.png}

\caption{Decision Logic: API Errors → Violations → Warnings → Proceed}
\end{figure}
\end{minipage}

%==============================================================================
% SECTION C: ORCHESTRATION
%==============================================================================
\section{Orchestration \& Event-Driven Flows}

\subsection{Triggers \& State Machine}

\begin{table}[H]
\footnotesize
\begin{tabularx}{\textwidth}{@{}llXl@{}}
\toprule
\textbf{Trigger} & \textbf{Source} & \textbf{Use Case} & \textbf{Endpoint} \\
\midrule
Webhook & Salesforce & Opportunity → ``Closed Won'' & \texttt{POST /webhook/onboarding} \\
Manual & CS Team & On-demand for specific account & \texttt{POST /demo/run/\{id\}} \\
Batch & Scheduler & Overnight processing & \texttt{POST /demo/run-all} \\
Task & CS Action & Mark task complete & \texttt{PUT /demo/tasks/\{id\}/\{task\}} \\
\bottomrule
\end{tabularx}
\end{table}

\vspace{-0.3em}
\textbf{State Machine}: LangGraph manages transitions: Init → Fetch(SF/CLM/NS) → Validate → Analyze → Decide → [Provision] → Notify → Complete. Each node handles errors gracefully, returning updated state. Conditional routing based on \texttt{api\_errors}, \texttt{violations}, \texttt{warnings}.

\textbf{Error Simulation}: \texttt{/demo/enable-random-errors} injects configurable failures (401 auth, 400 validation, 429 rate limit, 500 server) for resilience testing.

%==============================================================================
% SECTION D: TRADE-OFFS
%==============================================================================
\section{Trade-offs, Assumptions \& Considerations}

\begin{minipage}[t]{0.55\textwidth}
\vspace{0pt}
\subsection{Design Decisions}
\begin{table}[H]
\footnotesize
\begin{tabularx}{\textwidth}{@{}lX@{}}
\toprule
\textbf{Decision} & \textbf{Rationale} \\
\midrule
API Errors → BLOCK & Data integrity over speed \\
Sync Processing & Simple for demo; prod uses queues \\
Rule-based Fallback & Works without LLM connectivity \\
14 Fixed Tasks & Predictable; prod uses templates \\
\bottomrule
\end{tabularx}
\end{table}
\end{minipage}
\hfill
\begin{minipage}[t]{0.42\textwidth}
\vspace{0pt}
\subsection{Scalability \& Security}
\textbf{Scalability}: Sync → SQS/RabbitMQ, Memory → Redis, Single → K8s, + LLM caching

\textbf{Security}: OAuth 2.0 with token refresh, audit trails with correlation IDs, PII masking in logs, RBAC for API operations
\end{minipage}

%==============================================================================
% SECTION E: MCP COLLABORATION
%==============================================================================
\section{Multi-Agent Collaboration via MCP}

\begin{minipage}[t]{0.52\textwidth}
\vspace{0pt}
The \textbf{Model Context Protocol (MCP)} enables specialized agents to collaborate through standardized tool interfaces:

\begin{table}[H]
\footnotesize
\begin{tabularx}{\textwidth}{@{}lX@{}}
\toprule
\textbf{Agent} & \textbf{Responsibility \& Tools} \\
\midrule
Coordinator & Orchestrates workflow (\texttt{salesforce.*}, \texttt{provision.*}) \\
Contract & Monitors signatures (\texttt{clm.get\_contract}) \\
Finance & Tracks payments (\texttt{netsuite.get\_invoice}) \\
Task Monitor & Overdue detection (\texttt{tasks.get\_overdue}) \\
\bottomrule
\end{tabularx}
\end{table}

\textbf{Benefits}: Domain expert agents • Shared MCP servers reduce duplication • Add agents without modifying existing • Cross-agent context via tool responses
\end{minipage}
\hfill
\begin{minipage}[t]{0.45\textwidth}
\vspace{0pt}
\begin{figure}[H]
\centering
%\fbox{\parbox{0.95\textwidth}{\centering\vspace{1cm}\textbf{[INSERT: 03\_mcp\_architecture.mmd]}\vspace{1cm}}}
\includegraphics[width=0.95\textwidth]{03_mcp_architecture.png}
\caption{MCP: Agents → Router → Servers → APIs}
\end{figure}
\end{minipage}

\vfill
\begin{center}
\textcolor{secondary}{\footnotesize Enterprise Onboarding Agent | StackAdapt Case Study | GitHub: See attached code}
\end{center}

\end{document}
